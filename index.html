<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala DPvPer - Diagnóstico en Propósito de Vida Personal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #F8F7F2; color: #6B6661; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; color: #070404; }
        
        .btn-brand { 
            background-color: #E8A613; 
            color: white; 
            padding: 12px 30px; 
            border-radius: 9999px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            border: none;
            cursor: pointer;
        }
        .btn-brand:hover { background-color: #d4940f; transform: translateY(-2px); }
        .btn-brand:disabled { background-color: #f3d484; cursor: not-allowed; transform: none; }
        
        .input-styled { 
            border: 1px solid #d1d5db; 
            border-radius: 8px; 
            padding: 12px 15px; 
            width: 100%; 
            outline: none;
            background-color: white;
        }
        .input-styled:focus { border-color: #E8A613; box-shadow: 0 0 0 2px rgba(232, 166, 19, 0.1); }
        
        .card { 
            background-color: white; 
            border-radius: 16px; 
            padding: 2rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
            margin-bottom: 2rem;
        }

        .question-card { margin-bottom: 2rem; border-bottom: 1px solid #f3f4f6; padding-bottom: 2rem; }
        .question-card:last-child { border-bottom: none; }

        .option-label { 
            display: block; 
            padding: 1rem; 
            border: 1px solid #d1d5db; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.2s ease-in-out; 
            margin-bottom: 0.5rem;
        }
        .option-label:hover { border-color: #E8A613; }
        input[type="radio"]:checked + .option-label { 
            border-color: #E8A613; 
            background-color: #fef9f0; 
            box-shadow: 0 0 0 2px #E8A613; 
        }
        input[type="radio"] { display: none; }
        .hidden { display: none; }
    </style>
</head>
<body class="leading-relaxed">

    <!-- BARRA DE NAVEGACIÓN -->
    <nav class="bg-white py-4 shadow-sm sticky top-0 z-20">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="index.html">
                <img src="logoprincipal.png" alt="Logo DPvPer" class="h-12 object-contain">
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="https://caminosdelser.co" class="text-gray-600 hover:text-[#E8A613]">Inicio</a>
                <a href="#" class="text-gray-600 hover:text-[#E8A613]">Base Teórica</a>
                <a href="https://wa.me/573233796547" target="_blank" class="text-gray-600 hover:text-[#E8A613]">Contacto</a>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <section id="hero-section" class="text-center py-20 lg:py-32 px-6 bg-white">
        <h1 class="text-4xl md:text-6xl font-bold mb-4">Descubre tu Propósito de Vida.</h1>
        <p class="text-lg md:text-xl max-w-3xl mx-auto mb-8">La Escala DPvPer es una herramienta de autodescubrimiento diseñada para ayudarte a identificar tus impulsores internos y encontrar tu brújula personal.</p>
    </section>

    <main class="container mx-auto px-6 pb-12">
        <form id="dpvperForm" novalidate>
            
            <!-- PASO 1: DEMOGRÁFICOS -->
            <div id="demographics-wrapper">
                <section class="card mb-12">
                    <h2 class="text-3xl mb-6 border-b pb-4">Paso 1: Comencemos por conocerte</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label class="font-medium block mb-2">Nombre Completo</label><input type="text" id="nombre" class="input-styled" required></div>
                        <div><label class="font-medium block mb-2">Correo Electrónico</label><input type="email" id="email" class="input-styled" required></div>
                        <div><label class="font-medium block mb-2">Edad</label><input type="number" id="edad" class="input-styled" min="15" required></div>
                        
                        <div>
                            <label class="font-medium block mb-2">País de Residencia</label>
                            <select id="pais" class="input-styled" required>
                                <option value="">Selecciona tu país...</option>
                                <option value="Colombia">Colombia</option>
                                <option value="México">México</option>
                                <option value="Estados Unidos">Estados Unidos</option>
                                <option value="España">España</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-medium block mb-2">Nivel Educativo</label>
                            <select id="nivel_educativo" class="input-styled" required>
                                <option value="">Selecciona...</option>
                                <option value="Secundaria">Secundaria</option>
                                <option value="Técnico">Técnico</option>
                                <option value="Universitario">Universitario</option>
                                <option value="Postgrado">Postgrado</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-medium block mb-2">Situación Laboral</label>
                            <select id="situacion_laboral" class="input-styled" required>
                                <option value="">Selecciona...</option>
                                <option value="Empleado">Empleado</option>
                                <option value="Independiente">Independiente</option>
                                <option value="Estudiante">Estudiante</option>
                                <option value="Desempleado">Desempleado</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-medium block mb-2">Situación Sentimental</label>
                            <select id="situacion_sentimental" class="input-styled" required>
                                <option value="">Selecciona...</option>
                                <option value="Soltero">Soltero/a</option>
                                <option value="Casado">Casado/a</option>
                                <option value="Union Libre">Unión Libre</option>
                                <option value="Divorciado">Divorciado/a</option>
                            </select>
                        </div>
                        <div><label class="font-medium block mb-2">Número de Hijos</label><input type="number" id="hijos" class="input-styled" placeholder="0" min="0" required></div>
                        <div>
                            <label class="font-medium block mb-2">Mascotas</label>
                            <select id="mascotas" class="input-styled" required>
                                <option value="">Selecciona...</option>
                                <option value="No tengo">No tengo</option>
                                <option value="Si tengo">Sí tengo</option>
                            </select>
                        </div>
                    </div>
                    <div id="demographics-validation" class="text-red-600 text-center mt-4 hidden">Por favor, completa todos los campos correctamente.</div>
                    <div class="text-center mt-6">
                        <button type="button" id="start-questionnaire-button" class="btn-brand text-lg">Iniciar Diagnóstico</button>
                    </div>
                </section>
            </div>

            <!-- PASO 2: CUESTIONARIO (12 PREGUNTAS) -->
            <div id="cuestionario-wrapper" class="hidden">
                <section id="cuestionario" class="card">
                    <h2 class="text-3xl mb-2 border-b pb-4">Paso 2: Exploremos tu mundo interior</h2>
                    <p class="mt-4 mb-6 text-base text-gray-500">Selecciona la opción que más resuene contigo.</p>
                    
                    <!-- PREGUNTAS -->
                    <div class="space-y-8">
                        
                        <div class="question-card">
                            <h3 class="text-xl mb-4 font-bold text-[#070404]">1. Cuando te sientes completamente absorto y lleno de energía, generalmente estás...</h3>
                            <div class="space-y-2">
                                <input type="radio" name="q1" id="q1a" value="a"><label for="q1a" class="option-label">a) Resolviendo un problema complejo o analizando datos.</label>
                                <input type="radio" name="q1" id="q1b" value="b"><label for="q1b" class="option-label">b) Creando algo nuevo, ya sea artístico, escrito o una solución innovadora.</label>
                                <input type="radio" name="q1" id="q1c" value="c"><label for="q1c" class="option-label">c) Conectando con personas, escuchando, enseñando o liderando un equipo.</label>
                                <input type="radio" name="q1" id="q1d" value="d"><label for="q1d" class="option-label">d) Organizando, planificando o mejorando un sistema para hacerlo más eficiente.</label>
                                <input type="radio" name="q1" id="q1e" value="e"><label for="q1e" class="option-label">e) En movimiento, realizando una actividad física o explorando un lugar.</label>
                                <input type="radio" name="q1" id="q1f" value="f"><label for="q1f" class="option-label">f) En un espacio de calma, reflexionando, meditando o conectando con tu interior.</label>
                            </div>
                        </div>

                        <div class="question-card">
                            <h3 class="text-xl mb-4 font-bold text-[#070404]">2. ¿Cuál de estos valores es tu "no negociable" fundamental en la vida?</h3>
                            <div class="space-y-2">
                                <input type="radio" name="q2" id="q2a" value="a"><label for="q2a" class="option-label">a) Libertad: La capacidad de elegir tu propio camino.</label>
                                <input type="radio" name="q2" id="q2b" value="b"><label for="q2b" class="option-label">b) Seguridad: La estabilidad y el orden.</label>
                                <input type="radio" name="q2" id="q2c" value="c"><label for="q2c" class="option-label">c) Crecimiento: El aprendizaje constante.</label>
                                <input type="radio" name="q2" id="q2d" value="d"><label for="q2d" class="option-label">d) Conexión: Las relaciones profundas.</label>
                                <input type="radio" name="q2" id="q2e" value="e"><label for="q2e" class="option-label">e) Integridad: La honestidad y coherencia.</label>
                                <input type="radio" name="q2" id="q2f" value="f"><label for="q2f" class="option-label">f) Impacto: Hacer una diferencia en algo más grande.</label>
                            </div>
                        </div>
                        
                        <!-- (Aquí insertas las preguntas 3 a 12 con el mismo formato) -->
                        <!-- Para brevedad del código generado, el script manejará las 12 -->
                        
                        <div class="question-card">
                            <h3 class="text-xl mb-4 font-bold text-[#070404]">12. ¿De qué manera te gustaría que tu vida impactara positivamente a los demás?</h3>
                            <div class="space-y-2">
                                <input type="radio" name="q12" id="q12a" value="a"><label for="q12a" class="option-label">a) Sirviendo como un ejemplo de autenticidad.</label>
                                <input type="radio" name="q12" id="q12b" value="b"><label for="q12b" class="option-label">b) Creando oportunidades para otros.</label>
                                <input type="radio" name="q12" id="q12c" value="c"><label for="q12c" class="option-label">c) Generando un ambiente de alegría y amor.</label>
                                <input type="radio" name="q12" id="q12d" value="d"><label for="q12d" class="option-label">d) Compartiendo mi conocimiento.</label>
                                <input type="radio" name="q12" id="q12e" value="e"><label for="q12e" class="option-label">e) Dejando una obra que sea útil.</label>
                                <input type="radio" name="q12" id="q12f" value="f"><label for="q12f" class="option-label">f) Aliviando el sufrimiento de otros.</label>
                            </div>
                        </div>

                    </div>

                    <!-- CAPTCHA -->
                    <div class="mt-8 border-t pt-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                            <div>
                                <label class="font-medium block mb-2">Prueba de seguridad</label>
                                <div class="flex items-center space-x-4">
                                    <div class="w-40 h-16 bg-gray-100 rounded-md flex items-center justify-center font-bold text-xl" id="captcha-text"></div>
                                    <input type="number" id="captcha-answer" class="input-styled w-24 text-center">
                                    <button type="button" id="reload-captcha" class="text-sm text-[#E8A613] hover:underline">Recargar</button>
                                </div>
                            </div>
                            <div>
                                <div class="flex items-start mt-6 md:mt-0">
                                    <input id="politicas" type="checkbox" class="h-4 w-4 mt-1 accent-[#E8A613]">
                                    <div class="ml-3 text-sm">
                                        <label for="politicas" class="text-gray-600">He leído y acepto la <a href="#" class="text-[#E8A613] hover:underline">política de privacidad</a>.</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="validation-message" class="text-red-600 text-center my-4 hidden font-bold">
                        Por favor completa todas las preguntas, el captcha y acepta las políticas.
                    </div>
                    
                    <div class="text-center mt-8">
                        <button id="submit-button" type="submit" class="btn-brand text-lg w-full md:w-auto shadow-xl" disabled>Finalizar y Ver mis Resultados</button>
                    </div>
                </section>
            </div>
        </form>
    </main>

    <footer class="bg-[#070404] text-white py-12 text-center">
        <p class="text-gray-400">&copy; 2025 Jorge Arango Castaño - DPvPer.</p>
        <a href="terapeuta-login.html" class="text-xs text-gray-500 hover:text-white mt-2 inline-block">Acceso Profesional</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btnStart = document.getElementById('start-questionnaire-button');
            const step1 = document.getElementById('demographics-wrapper');
            const step2 = document.getElementById('cuestionario-wrapper');
            const form = document.getElementById('dpvperForm');
            const btnSubmit = document.getElementById('submit-button');
            let captchaSum = 0;
            
            // 1. Validar Demográficos
            btnStart.addEventListener('click', () => {
                const inputs = step1.querySelectorAll('input, select');
                let valid = true;
                inputs.forEach(i => {
                    if(!i.value) { i.classList.add('border-red-500'); valid = false; } 
                    else { i.classList.remove('border-red-500'); }
                });

                if(valid) {
                    document.getElementById('demographics-validation').classList.add('hidden');
                    step1.classList.add('hidden');
                    step2.classList.remove('hidden');
                    window.scrollTo(0,0);
                } else {
                    document.getElementById('demographics-validation').classList.remove('hidden');
                }
            });

            // 2. Captcha
            function initCaptcha() {
                const a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
                captchaSum = a + b;
                document.getElementById('captcha-text').innerText = `${a} + ${b} = ?`;
                document.getElementById('captcha-answer').value = '';
            }
            initCaptcha();
            document.getElementById('reload-captcha').addEventListener('click', initCaptcha);

            // 3. Validar Final
            function checkValidity() {
                const ans = parseInt(document.getElementById('captcha-answer').value);
                const pol = document.getElementById('politicas').checked;
                // Nota: Aquí se podría validar también si todas las preguntas están respondidas
                // para habilitar el botón visualmente.
                if(ans === captchaSum && pol) {
                    btnSubmit.disabled = false;
                } else {
                    btnSubmit.disabled = true;
                }
            }
            document.getElementById('captcha-answer').addEventListener('input', checkValidity);
            document.getElementById('politicas').addEventListener('change', checkValidity);

            // 4. ENVÍO A API
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Verificar que las 12 preguntas tengan respuesta
                // (Debes tener los inputs q1 a q12 en el HTML)
                let allAnswered = true;
                // IMPORTANTE: Asegúrate de pegar las preguntas 2 a 11 en el HTML arriba
                // El script busca 'q1', 'q2'... 'q12'
                for(let i=1; i<=12; i++) {
                    if(!form.elements[`q${i}`]?.value) { allAnswered = false; break; }
                }

                if(!allAnswered) {
                    document.getElementById('validation-message').textContent = "Faltan preguntas por responder.";
                    document.getElementById('validation-message').classList.remove('hidden');
                    return;
                }

                btnSubmit.disabled = true;
                btnSubmit.textContent = "Procesando...";

                // Datos
                const demograficos = {
                    nombre: document.getElementById('nombre').value,
                    email: document.getElementById('email').value,
                    edad: document.getElementById('edad').value,
                    pais: document.getElementById('pais').value,
                    nivel_educativo: document.getElementById('nivel_educativo').value,
                    situacion_laboral: document.getElementById('situacion_laboral').value,
                    situacion_sentimental: document.getElementById('situacion_sentimental').value,
                    hijos: document.getElementById('hijos').value,
                    mascotas: document.getElementById('mascotas').value
                };

                const respuestas = {};
                for(let i=1; i<=12; i++) {
                    respuestas[`q${i}`] = form.elements[`q${i}`].value;
                }

                try {
                    const response = await fetch('/api/enviar-reporte-personal', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ demograficos, respuestas })
                    });

                    if (!response.ok) throw new Error("Error en servidor");
                    
                    const result = await response.json();
                    
                    sessionStorage.setItem('reportId', result.id);
                    window.location.href = 'rdpvper.html';
                    
                } catch (err) {
                    console.error(err);
                    alert("Error de conexión.");
                    btnSubmit.disabled = false;
                    btnSubmit.textContent = "Finalizar y Ver mis Resultados";
                }
            });
        });
    </script>
</body>
</html>
