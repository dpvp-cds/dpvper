<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala DPvPer - Diagnóstico en Propósito de Vida Personal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #F8F7F2; color: #6B6661; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; color: #070404; }
        .btn-brand { background-color: #E8A613; color: white; padding: 12px 30px; border-radius: 9999px; font-weight: 600; transition: all 0.3s ease; }
        .btn-brand:hover { background-color: #d4940f; transform: translateY(-2px); }
        .btn-brand:disabled { background-color: #f3d484; cursor: not-allowed; }
        .input-styled { border: 1px solid #d1d5db; border-radius: 8px; padding: 10px 15px; width: 100%; background-color: white; }
        .card { background-color: white; border-radius: 16px; padding: 2rem; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); }
        .pregunta-card { border-left: 4px solid #E8A613; }
        .radio-label { display: flex; align-items: center; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; }
        .radio-label:hover { border-color: #E8A613; }
        input[type="radio"]:checked + .radio-label { background-color: #fef3c7; border-color: #E8A613; box-shadow: 0 0 0 2px rgba(232, 166, 19, 0.3); }
        input[type="radio"] { opacity: 0; width: 0; height: 0; }
    </style>
</head>
<body class="leading-relaxed">

    <header class="bg-white shadow-sm py-6">
        <div class="container mx-auto px-6 text-center">
            <h1 class="text-4xl md:text-5xl font-bold">Escala DPvPer</h1>
            <p class="mt-2 text-lg">Diagnóstico en Propósito de Vida Personal</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <form id="dpvperForm" class="space-y-12">
            
            <div id="demograficos" class="card">
                <h2 class="text-2xl font-bold mb-6 border-b pb-4">Información Demográfica</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="nombre" class="block mb-2 font-medium">Nombre Completo</label>
                        <input type="text" id="nombre" name="nombre" class="input-styled" required>
                    </div>
                    <div>
                        <label for="email" class="block mb-2 font-medium">Correo Electrónico</label>
                        <input type="email" id="email" name="email" class="input-styled" required>
                    </div>
                    <div>
                        <label for="edad" class="block mb-2 font-medium">Edad</label>
                        <input type="number" id="edad" name="edad" class="input-styled" required>
                    </div>
                    <div>
                        <label for="ciudad" class="block mb-2 font-medium">Ciudad y País de Residencia</label>
                        <input type="text" id="ciudad" name="ciudad" class="input-styled" required>
                    </div>
                </div>
            </div>

            <div id="cuestionario" class="card">
                <h2 class="text-2xl font-bold mb-2">Cuestionario</h2>
                <p class="mb-6 text-gray-500">Evalúa cada afirmación de 0 a 10, donde 0 es "Totalmente en desacuerdo" y 10 es "Totalmente de acuerdo".</p>
                <div id="preguntasContainer" class="space-y-8">
                    </div>
            </div>

            <div class="text-center">
                <button type="submit" id="submitButton" class="btn-brand text-lg">Finalizar y Ver mis Resultados</button>
            </div>
        </form>
    </main>

    <footer class="bg-[#070404] text-white py-12 mt-12">
        <div class="container mx-auto text-center">
            <p class="text-gray-400">&copy; 2025 Jorge Arango Castaño - Caminos del Ser.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const preguntas = [
                { id: 'P1', texto: '¿Sientes que tienes un propósito claro en la vida?', arquetipo: 'd' }, { id: 'P2', texto: '¿Te consideras una persona creativa y original?', arquetipo: 'b' }, { id: 'P3', texto: '¿Disfrutas de la aventura y de explorar nuevos lugares o ideas?', arquetipo: 'e' }, { id: 'P4', texto: '¿Valoras la seguridad y la estabilidad por encima de todo?', arquetipo: 'f' }, { id: 'P5', texto: '¿Te sientes cómodo liderando a otros y tomando decisiones importantes?', arquetipo: 'g' }, { id: 'P6', texto: '¿La gente te busca por tu sabiduría y tus consejos?', arquetipo: 'd' }, { id: 'P7', texto: '¿Te esfuerzas por superar los obstáculos con valentía y determinación?', arquetipo: 'a' }, { id: 'P8', texto: '¿Buscas constantemente transformar las situaciones para mejorarlas?', arquetipo: 'h' }, { id: 'P9', texto: '¿Para ti es fundamental conectar emocionalmente con las personas?', arquetipo: 'c' }, { id: 'P10', texto: '¿Crees que la vida es un viaje lleno de maravillas por descubrir?', arquetipo: 'e' }, { id: 'P11', texto: '¿Prefieres construir algo nuevo y duradero a seguir lo ya establecido?', arquetipo: 'b' }, { id: 'P12', texto: '¿Te sientes responsable del bienestar de tu comunidad o grupo?', arquetipo: 'g' }, { id: 'P13', texto: '¿Crees en el poder del amor y la pasión para guiar tus acciones?', arquetipo: 'c' }, { id: 'P14', texto: '¿Confías en tu intuición y en tu capacidad para que las cosas sucedan?', arquetipo: 'h' }, { id: 'P15', texto: '¿Te identificas con la lucha por la justicia y la defensa de los débiles?', arquetipo: 'a' }, { id: 'P16', texto: '¿Mantienes una actitud optimista y confías en la bondad de los demás?', arquetipo: 'f' }, { id: 'P17', texto: '¿El análisis y la reflexión son cruciales antes de tomar una decisión?', arquetipo: 'd' }, { id: 'P18', texto: '¿Te sientes lleno de energía cuando enfrentas un desafío competitivo?', arquetipo: 'a' }, { id: 'P19', texto: '¿Sientes una profunda curiosidad por entender cómo funciona el mundo?', arquetipo: 'h' }, { id: 'P20', texto: '¿La belleza, la estética y la sensualidad son importantes en tu vida?', arquetipo: 'c' }, { id: 'P21', texto: '¿Sueñas con crear una obra (artística, empresarial, etc.) que deje un legado?', arquetipo: 'b' }, { id: 'P22', texto: '¿Buscas la libertad y la independencia en todos los aspectos de tu vida?', arquetipo: 'e' }, { id: 'P23', texto: '¿Crees que las reglas y el orden son esenciales para una sociedad funcional?', arquetipo: 'g' }, { id: 'P24', texto: '¿Tiendes a ver el lado bueno de las cosas y a esperar un final feliz?', arquetipo: 'f' }, { id: 'P25', texto: '¿Te consideras un maestro o mentor para otras personas?', arquetipo: 'd' }, { id: 'P26', texto: '¿Estás dispuesto a sacrificarte para proteger a quienes amas?', arquetipo: 'a' }, { id: 'P27', texto: '¿Te atrae el misterio y lo que no se ve a simple vista?', arquetipo: 'h' }, { id: 'P28', texto: '¿Valoras las relaciones íntimas y cercanas por encima de los logros materiales?', arquetipo: 'c' }, { id: 'P29', texto: '¿La autoexpresión a través de alguna forma de arte o creación es vital para ti?', arquetipo: 'b' }, { id: 'P30', texto: '¿Sientes un llamado a viajar y experimentar diferentes culturas?', arquetipo: 'e' }, { id: 'P31', texto: '¿Asumes el control de las situaciones para garantizar el éxito?', arquetipo: 'g' }, { id: 'P32', texto: '¿Crees en la simplicidad y en encontrar la felicidad en las pequeñas cosas?', arquetipo: 'f' }, { id: 'P33', texto: '¿La búsqueda de la verdad y el conocimiento es una de tus mayores motivaciones?', arquetipo: 'd' }, { id: 'P34', texto: '¿Te ves a ti mismo como un pionero que abre nuevos caminos?', arquetipo: 'e' }, { id: 'P35', texto: '¿Tienes la habilidad de inspirar cambios profundos en los demás?', arquetipo: 'h' }, { id: 'P36', texto: '¿La lealtad y el compromiso son valores centrales en tus relaciones?', arquetipo: 'c' }, { id: 'P37', texto: '¿Tienes una visión clara de lo que quieres construir en tu futuro?', arquetipo: 'b' }, { id: 'P38', texto: '¿Te consideras una persona disciplinada y con autocontrol?', arquetipo: 'a' }, { id: 'P39', texto: '¿Te sientes más realizado cuando ejerces una posición de influencia y autoridad?', arquetipo: 'g' }, { id: 'P40', texto: '¿Crees que la fe y la esperanza pueden superar cualquier adversidad?', arquetipo: 'f' }
            ];

            const container = document.getElementById('preguntasContainer');
            preguntas.forEach((pregunta, index) => {
                const preguntaHtml = `
                    <div class="pregunta-card bg-gray-50 p-6 rounded-lg">
                        <label class="block text-lg font-semibold text-gray-800 mb-4">${index + 1}. ${pregunta.texto}</label>
                        <div class="flex flex-wrap justify-center gap-2">
                            ${[...Array(11).keys()].map(valor => `
                                <div class="flex-shrink-0">
                                    <input type="radio" name="${pregunta.id}" id="${pregunta.id}-${valor}" value="${valor}" data-arquetipo="${pregunta.arquetipo}" required>
                                    <label for="${pregunta.id}-${valor}" class="radio-label w-12 h-12 flex items-center justify-center font-bold text-lg">
                                        ${valor}
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.innerHTML += preguntaHtml;
            });

            const form = document.getElementById('dpvperForm');
            const submitButton = document.getElementById('submitButton');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                submitButton.disabled = true;
                submitButton.textContent = 'Procesando...';

                // --- 1. CREAR UN MAPA DE PREGUNTAS PARA BÚSQUEDA FÁCIL ---
                const preguntasMap = new Map(preguntas.map(p => [p.id, p]));

                // --- 2. USAR FormData PARA LEER LOS DATOS DEL FORMULARIO DE FORMA CONFIABLE ---
                const formData = new FormData(form);
                
                const demograficos = {};
                const resultados = { a: 0, b: 0, c: 0, d: 0, e: 0, f: 0, g: 0, h: 0 };
                const detalles = {};

                // --- 3. PROCESAR TODOS LOS DATOS DEL FORMULARIO ---
                for (const [key, value] of formData.entries()) {
                    // Si la clave es una pregunta (ej: 'P1', 'P2', etc.)
                    if (preguntasMap.has(key)) {
                        const pregunta = preguntasMap.get(key);
                        const arquetipo = pregunta.arquetipo;
                        const valorNum = parseInt(value, 10);

                        // Sumar al puntaje del arquetipo
                        if (resultados.hasOwnProperty(arquetipo)) {
                            resultados[arquetipo] += valorNum;
                        }

                        // Guardar la respuesta detallada
                        detalles[key] = {
                            pregunta: pregunta.texto,
                            textoRespuesta: value, // El valor seleccionado es la respuesta
                            valor: valorNum
                        };
                    } 
                    // Si no es una pregunta, es un dato demográfico
                    else {
                        demograficos[key] = value;
                    }
                }
                
                // --- 4. NORMALIZAR LOS RESULTADOS (DIVIDIR POR 5) ---
                for (const arquetipo in resultados) {
                    resultados[arquetipo] = resultados[arquetipo] / 5;
                }

                // --- 5. CONSTRUIR EL OBJETO FINAL ---
                const datosCompletos = {
                    demograficos,
                    resultados,
                    detalles
                };
                
                sessionStorage.setItem('dpvperResultados', JSON.stringify(datosCompletos));

                // --- 6. ENVIAR A LA API ---
                try {
                    const response = await fetch('/api/enviar-reporte-personal', {
                        method: 'POST',
                        body: JSON.stringify(datosCompletos),
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (response.ok) {
                        window.location.href = `rdpvper.html`;
                    } else {
                        const errorData = await response.json();
                        alert(`Error: ${errorData.message || 'Hubo un problema al enviar tus resultados.'}`);
                        submitButton.disabled = false;
                        submitButton.textContent = 'Finalizar y Ver mis Resultados';
                    }
                } catch (error) {
                    alert('Hubo un error de conexión. Por favor, revisa tu conexión a internet e intenta de nuevo.');
                    submitButton.disabled = false;
                    submitButton.textContent = 'Finalizar y Ver mis Resultados';
                }
            });
        });
    </script>
</body>
</html>
