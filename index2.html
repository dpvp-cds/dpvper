<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala DPvPer - Diagnóstico en Propósito de Vida Personal (DEV)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #F8F7F2; color: #6B6661; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; color: #070404; }
        .btn-brand { background-color: #E8A613; color: white; padding: 12px 30px; border-radius: 9999px; font-weight: 600; transition: all 0.3s ease; }
        .btn-brand:hover { background-color: #d4940f; transform: translateY(-2px); }
        .btn-brand:disabled { background-color: #f3d484; cursor: not-allowed; transform: none; }
        .input-styled, .select-styled { border: 1px solid #d1d5db; border-radius: 8px; padding: 10px 15px; width: 100%; transition: border-color 0.3s, box-shadow 0.3s; }
        .input-styled:focus, .select-styled:focus { border-color: #E8A613; box-shadow: 0 0 0 2px rgba(232, 166, 19, 0.2); outline: none; }
        .card { background-color: white; border-radius: 16px; padding: 2rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .question-card { margin-bottom: 1.5rem; border-left: 4px solid #E8A613; padding-left: 1.5rem; }
        .progress-bar-bg { background-color: #e0e0e0; }
        .progress-bar-fill { background-color: #E8A613; transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white py-4 shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-6 flex justify-between items-center">
             <a href="/" class="flex items-center space-x-3">
                <img src="logoprincipal.jpg" alt="Logo Caminos del Ser" class="h-12 w-auto">
                <h1 class="text-xl font-bold tracking-tight">Caminos del Ser</h1>
            </a>
            <h2 class="text-lg font-semibold text-gray-700 hidden sm:block">Test DPvPer (Entorno de Pruebas)</h2>
        </div>
    </header>
    
    <main class="container mx-auto px-6 py-12 md:py-16">
        <div class="max-w-3xl mx-auto">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">Diagnóstico en Propósito de Vida Personal</h1>
                <p class="text-lg md:text-xl text-gray-600">Un viaje hacia el autoconocimiento y la alineación con tu esencia.</p>
            </div>

            <form id="dpvper-form" class="space-y-8">
                
                <div class="card">
                    <h2 class="text-2xl font-bold mb-6 border-b pb-3">Información Básica</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="nombre" class="block mb-2 font-medium">Nombre Completo</label>
                            <input type="text" id="nombre" name="nombre" class="input-styled" required>
                        </div>
                        <div>
                            <label for="email" class="block mb-2 font-medium">Correo Electrónico</label>
                            <input type="email" id="email" name="email" class="input-styled" required>
                        </div>
                        <div>
                            <label for="edad" class="block mb-2 font-medium">Edad</label>
                            <input type="number" id="edad" name="edad" class="input-styled" required min="15">
                        </div>
                         <div>
                            <label for="genero" class="block mb-2 font-medium">Género</label>
                            <select id="genero" name="genero" class="select-styled" required>
                                <option value="">Selecciona una opción</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Otro">Otro</option>
                                <option value="Prefiero no decir">Prefiero no decir</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-lg font-semibold mb-2">Progreso del Cuestionario</h3>
                    <div class="progress-bar-bg w-full rounded-full h-4">
                        <div id="progress-bar" class="progress-bar-fill h-4 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" class="text-center mt-2 text-sm font-medium">0 de 24 respondidas</p>
                </div>
                
                <div id="cuestionario" class="card">
                    <h2 class="text-2xl font-bold mb-6 border-b pb-3">Cuestionario</h2>
                    </div>
                
                <div class="text-center">
                    <button type="submit" id="submit-button" class="btn-brand text-lg">Finalizar y Ver mis Resultados</button>
                </div>

            </form>
        </div>
    </main>

    <footer class="bg-[#070404] text-white py-12 mt-16">
        <div class="container mx-auto text-center">
            <p class="text-gray-400">&copy; 2025 Jorge Arango Castaño - Caminos del Ser. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const preguntas = [
                // HABILIDADES Y ESENCIA (H)
                "¿Reconoces y utilizas tus talentos y habilidades principales en tu día a día?",
                "¿Tienes claros cuáles son tus valores 'no negociables' en la vida?",
                "¿Sientes que tus acciones diarias reflejan quién eres en esencia?",
                "¿Identificas fácilmente en qué actividades 'se te pasa el tiempo volando'?",
                // ASPIRACIÓN Y VISIÓN (A)
                "¿Tienes una imagen clara de la persona en la que te quieres convertir en 5 o 10 años?",
                "¿Tus metas actuales te entusiasman y te motivan a levantarte por la mañana?",
                "¿Sientes que estás creciendo y evolucionando constantemente como persona?",
                "¿Dedicas tiempo a soñar o planificar sobre tu futuro deseado?",
                // LÓGICA Y COHERENCIA (L)
                "¿Consideras que hay coherencia entre lo que piensas, lo que dices y lo que haces?",
                "¿Tus decisiones importantes se alinean con tus valores fundamentales?",
                "Cuando te comprometes a algo, ¿sueles cumplir tu palabra?",
                "¿Te sientes en paz con las decisiones que has tomado en el último año?",
                // CONSTRUCCIÓN Y CONCRECIÓN (C)
                "¿Sueles dividir tus grandes metas en pasos más pequeños y manejables?",
                "¿Tienes un plan de acción, aunque sea simple, para tus objetivos más importantes?",
                "¿Utilizas algún método para organizar tus tareas y proyectos (agenda, apps, etc.)?",
                "¿Al mirar atrás, ves proyectos o metas importantes que has completado exitosamente?",
                // ORIENTACIÓN Y ADAPTACIÓN (O)
                "Cuando enfrentas un obstáculo, ¿buscas diferentes maneras de superarlo?",
                "¿Eres capaz de ajustar tus planes cuando las circunstancias cambian inesperadamente?",
                "¿Aprendes de tus errores para tomar mejores decisiones en el futuro?",
                "Ante un conflicto, ¿buscas soluciones que beneficien a todas las partes implicadas?",
                // NUTRICIÓN Y TRASCENDENCIA (N)
                "¿Dedicas tiempo regularmente a actividades que cuidan tu bienestar físico y mental?",
                "¿Sientes que tu vida tiene un impacto positivo, por pequeño que sea, en los demás?",
                "¿Practicas la gratitud por lo que tienes en tu vida?",
                "¿Piensas en el legado o la huella que te gustaría dejar en el mundo?"
            ];

            const form = document.getElementById('dpvper-form');
            const cuestionarioDiv = document.getElementById('cuestionario');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            preguntas.forEach((pregunta, index) => {
                const i = index + 1;
                const questionBlock = `
                    <div class="question-card">
                        <label for="q${i}" class="block text-lg font-medium mb-3">${i}. ${pregunta}</label>
                        <div class="flex justify-around items-center flex-wrap gap-2">
                            <span class="text-gray-500">En desacuerdo</span>
                            <input type="radio" name="q${i}" value="1" class="h-4 w-4" required>
                            <input type="radio" name="q${i}" value="2" class="h-4 w-4" required>
                            <input type="radio" name="q${i}" value="3" class="h-4 w-4" required>
                            <input type="radio" name="q${i}" value="4" class="h-4 w-4" required>
                            <input type="radio" name="q${i}" value="5" class="h-4 w-4" required>
                            <span class="text-gray-500">De acuerdo</span>
                        </div>
                    </div>
                `;
                cuestionarioDiv.innerHTML += questionBlock;
            });
            
            const totalQuestions = preguntas.length;
            const radioButtons = form.querySelectorAll('input[type="radio"]');

            const updateProgress = () => {
                const answeredQuestions = form.querySelectorAll('input[type="radio"]:checked').length;
                const percentage = (answeredQuestions / totalQuestions) * 100;
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${answeredQuestions} de ${totalQuestions} respondidas`;
            };

            radioButtons.forEach(radio => radio.addEventListener('change', updateProgress));

            form.addEventListener('submit', async function (e) {
                e.preventDefault();
                const submitButton = document.getElementById('submit-button');
                submitButton.disabled = true;
                submitButton.textContent = 'Procesando...';

                const demograficos = {
                    nombre: form.elements.nombre.value,
                    email: form.elements.email.value,
                    edad: form.elements.edad.value,
                    genero: form.elements.genero.value,
                    fecha: new Date().toISOString()
                };

                const respuestas = {};
                for (let i = 1; i <= totalQuestions; i++) {
                    respuestas[`q${i}`] = form.elements[`q${i}`].value;
                }

                const datosCompletos = {
                    demograficos,
                    respuestas,
                    tipo: 'DPvPer'
                };
                
                sessionStorage.setItem('dpvperResultados', JSON.stringify(datosCompletos));

                try {
                    const response = await fetch('/api/enviar-reporte-personal', {
                        method: 'POST',
                        body: JSON.stringify(datosCompletos),
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (response.ok) {
                        // AQUÍ ESTÁ LA ÚNICA MODIFICACIÓN: Redirigimos a la nueva página de desarrollo
                        window.location.href = `rdpvper2.html`;
                    } else {
                        const errorData = await response.json();
                        alert(`Error: ${errorData.message || 'Hubo un problema al enviar tus resultados.'}`);
                        submitButton.disabled = false;
                        submitButton.textContent = 'Finalizar y Ver mis Resultados';
                    }
                } catch (error) {
                    alert('Hubo un error de conexión. Por favor, revisa tu conexión a internet e intenta de nuevo.');
                    submitButton.disabled = false;
                    submitButton.textContent = 'Finalizar y Ver mis Resultados';
                }
            });
        });
    </script>
</body>
</html>
